# WSJ 뉴스 분석 워크플로우 멀티 에이전트 설계 토론

## 토론 참가자
- **Orchestrator Agent**: 전체 워크플로우 조율 담당
- **Crawler Agent**: WSJ 크롤링 담당
- **Categorizer Agent**: 카테고리 분류 담당
- **Analyzer Agent**: 기사 내용 분석 담당
- **Fact Checker Agent**: 팩트 체크 담당
- **Documenter Agent**: 문서화 담당

---

## 1차 토론: 워크플로우 구조

### Orchestrator Agent
> 안녕하세요, 여러분. 저는 전체 워크플로우를 조율하는 역할을 맡게 되었습니다. 제안된 구조를 보면:
> 
> 1. 크롤링 → 2. 카테고리 분류 → 3. 기사 분석 → 4. 팩트 체크 → 5. 문서화
> 
> 이 순서가 논리적인지 검토가 필요합니다. 특히 각 단계 간 데이터 전달 방식과 에러 처리에 대해 논의가 필요합니다.

### Crawler Agent
> 네, 저는 WSJ Finance 섹션에서 기사 목록을 수집하는 역할입니다. 
> 
> **제 우려사항:**
> 1. WSJ는 로그인이 필요하고, 로그인 세션이 만료될 수 있습니다. Analyzer Agent가 나중에 기사를 읽을 때도 로그인이 필요한데, 세션을 어떻게 공유할지가 문제입니다.
> 2. 기사가 많을 경우 (50개 이상) 크롤링 시간이 오래 걸릴 수 있습니다. 타임아웃 처리가 필요합니다.
> 3. 동적 로딩되는 기사들이 있을 수 있어, Playwright로 충분히 대기해야 합니다.
> 
> **제안:** 로그인 정보를 한 번만 입력받고, 세션을 파일로 저장해서 재사용하는 방식은 어떨까요?

### Analyzer Agent
> Crawler Agent의 제안에 동의합니다. 제가 각 기사를 읽을 때마다 로그인하는 것은 비효율적입니다.
> 
> **추가 제안:**
> - 각 기사를 읽을 때마다 Playwright 세션을 유지하는 대신, 브라우저 컨텍스트를 재사용해야 합니다.
> - 다만, WSJ는 프리미엄 기사가 있을 수 있고, 일부 기사는 접근이 제한될 수 있습니다. 이런 경우를 어떻게 처리할지 논의가 필요합니다.

### Fact Checker Agent
> Analyzer Agent가 이미 기사를 읽었는데, 제가 다시 읽어야 하는가요? 이건 중복 작업인 것 같습니다.
> 
> **제안:** Analyzer Agent가 기사를 읽을 때 원문 텍스트도 함께 저장하면, 제가 재확인할 때 원문을 직접 참조할 수 있습니다. 모든 기사를 다시 읽는 것보다 효율적일 것 같습니다.

### Analyzer Agent
> 좋은 제안입니다! 저는 기사 내용을 분석할 때 원문 텍스트를 `data/YYYYMMDD/articles/[article_id]_original.txt` 형태로 저장하겠습니다. 그러면 Fact Checker Agent가 필요할 때만 해당 파일을 읽어서 검증할 수 있습니다.

### Categorizer Agent
> 저는 크롤링된 기사 목록만 보고 카테고리를 분류하는데, 제목과 미리보기만으로는 정확한 분류가 어려울 수 있습니다.
> 
> **제안:** 일단 제목과 미리보기로 임시 분류를 하고, Analyzer Agent가 기사를 읽은 후에 카테고리를 재분류하거나 확인하는 단계를 추가하는 것은 어떨까요?

### Orchestrator Agent
> 좋은 제안들이 나왔습니다. 정리하면:
> 
> 1. **로그인 세션 관리**: 한 번만 로그인하고 세션을 재사용
> 2. **원문 텍스트 저장**: Analyzer가 원문을 파일로 저장하여 Fact Checker가 재사용
> 3. **카테고리 재분류**: Analyzer가 기사 내용을 읽은 후 카테고리 확인/수정
> 
> 이렇게 하면 워크플로우가 더 효율적이 될 것 같습니다.

---

## 2차 토론: 데이터 구조와 형식

### Documenter Agent
> 저는 최종 문서를 작성하는 역할인데, 입력 데이터 형식이 명확해야 합니다.
> 
> 예시 파일(`WSJ_Finance_Daily_Analysis_251104.md`)을 보니 매우 상세한 구조가 필요합니다:
> - 시장 개황 (지수 데이터)
> - 섹터별 상세 분석
> - 검증 팩트 체크
> - 핵심 인사이트
> - 리스크 요인
> 
> **질문:** 시장 지수 데이터는 어디서 가져오나요? WSJ Finance 섹션에 이런 정보가 있나요?

### Crawler Agent
> 시장 지수는 WSJ Finance 섹션 상단에 있을 수 있지만, 정확한 위치를 확인해야 합니다. 아니면 별도로 시장 데이터를 크롤링해야 할 수도 있습니다.

### Analyzer Agent
> 시장 지수는 보통 Finance 섹션의 주요 기사 중 하나에 포함되어 있을 가능성이 높습니다. 예를 들어 "Stocks Rise as AI Investment Continues" 같은 기사에 지수 데이터가 포함될 수 있습니다.
> 
> **제안:** 시장 개황 섹션은 별도의 처리 로직이 필요할 수 있습니다. "Market Overview" 또는 "Stocks" 관련 기사를 우선적으로 분석하여 지수 데이터를 추출하는 방식은 어떨까요?

### Fact Checker Agent
> 검증 팩트 체크 섹션에서 제가 확인해야 할 항목들이 많습니다. 
> 
> **제안:** 각 기사마다 검증해야 할 핵심 사실(Key Facts) 리스트를 Analyzer Agent가 생성하면, 제가 그것들을 하나씩 검증할 수 있습니다. 검증 결과는 다음과 같은 형식으로 저장하면 좋을 것 같습니다:
> 
> ```json
> {
>   "fact_id": "fact_001",
>   "fact_text": "거래 가액: 48억 달러",
>   "status": "verified",
>   "original_text": "원문 인용",
>   "notes": "부채 포함 48.7B로 확인됨"
> }
> ```

### Documenter Agent
> 그렇다면 Fact Checker Agent가 검증한 결과를 바탕으로 "검증 팩트 체크" 섹션을 자동으로 생성할 수 있겠네요. 
> 
> **질문:** 각 섹터별 분석의 형식이 일관되어야 하는데, 예를 들어 M&A 거래마다 "거래 구조", "전략적 배경", "리스크 요인", "시장 반응" 같은 하위 섹션이 필요합니다. 이런 구조를 템플릿화할 수 있을까요?

### Orchestrator Agent
> 좋은 제안입니다. 템플릿 기반 접근이 일관성을 유지하는 데 도움이 될 것 같습니다.
> 
> **제안:** `.agents/templates/` 폴더에 카테고리별 템플릿을 만들어두면, Documenter Agent가 이를 참조하여 문서를 생성할 수 있습니다.

---

## 3차 토론: 에러 처리 및 재시도 로직

### Orchestrator Agent
> 에러 처리가 중요한데, 각 단계에서 실패할 경우 어떻게 대응할지 논의가 필요합니다.

### Crawler Agent
> 제가 크롤링할 때 실패할 수 있는 경우:
> 1. 로그인 실패 → 3회 재시도
> 2. 네트워크 오류 → 5초 대기 후 재시도
> 3. 페이지 로드 실패 → 최대 3회 재시도
> 
> 모든 재시도가 실패하면 Orchestrator에게 에러 보고하고 중단해야 합니다.

### Analyzer Agent
> 제가 기사를 읽을 때 실패할 수 있는 경우:
> 1. 개별 기사 접속 실패 → 해당 기사 스킵하고 다음 기사로 진행
> 2. 로그인 세션 만료 → Crawler Agent에게 세션 갱신 요청
> 3. 기사가 삭제되었거나 접근 불가 → 스킵하고 로그 기록
> 
> **제안:** 부분 실패를 허용하는 것이 좋을 것 같습니다. 50개 중 2-3개가 실패해도 나머지는 계속 처리할 수 있어야 합니다.

### Fact Checker Agent
> 제가 검증할 때 원문 파일이 없거나 접근 불가한 경우, Analyzer Agent가 저장한 분석 결과만으로 검증을 진행할 수 있습니다. 다만 신뢰도는 낮아집니다.
> 
> **제안:** 검증 수준을 표시하는 것이 좋을 것 같습니다:
> - ✅ 원문 재확인 완료
> - ⚠️ 분석 결과만 확인
> - ❌ 확인 불가

### Documenter Agent
> 저는 입력 데이터가 불완전해도 가능한 한 문서를 생성해야 합니다. 누락된 부분은 "[확인 필요]" 같은 표시를 하면 될 것 같습니다.

---

## 4차 토론: 성능 최적화

### Crawler Agent
> 기사가 많을 경우 (100개 이상) 전체 처리 시간이 매우 오래 걸릴 수 있습니다.
> 
> **제안:** 
> 1. 우선순위 기사부터 처리 (예: ⭐ 표시된 주요 거래)
> 2. 병렬 처리: 여러 기사를 동시에 읽는 것은 WSJ의 Rate Limiting 때문에 어렵지만, 배치 처리로 시간을 단축할 수 있습니다.

### Analyzer Agent
> 제가 각 기사를 읽을 때 2-3초씩 대기하면, 50개 기사를 처리하는데만 2-3분이 걸립니다. 전체 워크플로우는 10분 이상 걸릴 수 있습니다.
> 
> **제안:** 사용자에게 진행 상황을 실시간으로 알려주는 것이 좋을 것 같습니다. "50개 중 25개 완료..." 같은 메시지를 출력하면 좋겠습니다.

### Orchestrator Agent
> 좋은 제안입니다. 각 단계에서 진행 상황을 로그로 출력하고, 최종적으로는 처리 시간과 통계를 요약해서 보여주는 것이 좋겠습니다.

---

## 5차 토론: 사용자 인터페이스

### Orchestrator Agent
> 사용자가 Cursor 채팅에서 "WSJ 뉴스 분석해줘"라고 요청하면, 어떻게 실행해야 할까요?

### Documenter Agent
> 각 에이전트를 `@mention`으로 호출하는 방식이 좋을 것 같습니다. 
> 
> 예를 들어:
> ```
> @00_orchestrator WSJ 뉴스 분석 실행
> ```
> 
> 그러면 Orchestrator가 다른 에이전트들을 순차적으로 호출합니다.

### Fact Checker Agent
> 사용자가 특정 날짜를 지정할 수도 있고, 특정 단계만 재실행하고 싶을 수도 있습니다.
> 
> **제안:** 
> - "2025년 11월 3일 뉴스 분석"
> - "팩트 체크만 다시 해줘" (이미 분석된 데이터 기반)
> 
> 이런 유연성이 필요합니다.

### Orchestrator Agent
> 좋습니다. 제가 사용자의 요청을 파싱해서 적절한 단계만 실행하거나, 전체 워크플로우를 실행할 수 있도록 하겠습니다.

---

## 최종 합의 사항

### 1. 워크플로우 개선
- ✅ 로그인 세션은 한 번만 수행하고 재사용
- ✅ Analyzer가 원문 텍스트를 파일로 저장하여 Fact Checker가 재사용
- ✅ Analyzer가 기사 내용을 읽은 후 카테고리 재확인/수정

### 2. 데이터 구조
- ✅ 각 기사마다 원문 텍스트 파일 저장 (`data/YYYYMMDD/articles/[id]_original.txt`)
- ✅ 검증 팩트는 구조화된 JSON 형식으로 저장
- ✅ 카테고리별 템플릿 생성

### 3. 에러 처리
- ✅ 부분 실패 허용 (일부 기사 실패해도 계속 진행)
- ✅ 검증 수준 표시 (✅ ⚠️ ❌)
- ✅ 각 단계별 재시도 로직 포함

### 4. 사용자 경험
- ✅ 진행 상황 실시간 출력
- ✅ 유연한 실행 옵션 (전체 실행 / 특정 단계만 실행)
- ✅ 날짜 지정 가능

### 5. 파일 구조
```
.agents/
  ├── 00_orchestrator.md          # 메인 워크플로우
  ├── utils/
  │   ├── crawler.md              # 크롤링
  │   ├── categorizer.md          # 카테고리 분류
  │   ├── analyzer.md             # 기사 분석
  │   ├── fact_checker.md         # 팩트 체크
  │   └── documenter.md           # 문서화
  └── templates/
      ├── m_and_a_template.md     # M&A 템플릿
      ├── market_overview_template.md
      └── ...

data/
  └── YYYYMMDD/
      ├── raw_articles.json
      ├── categorized.json
      ├── analyzed_content.json
      ├── verified.json
      └── articles/
          └── [article_id]_original.txt
```

---

## 다음 단계

이제 각 에이전트 파일을 위의 합의 사항을 반영하여 작성하겠습니다.

