# WSJ 뉴스 분석 워크플로우 핵심 원칙

## 1. 자동화 우선 (Automation First)

### 원칙
한 번의 명령으로 전체 워크플로우가 끝까지 자동으로 실행되어야 합니다.

### 적용
- **사용자 개입**: 로그인만 직접 (브라우저 띄워주면 수동 로그인)
- **로그인 완료 확인**: 
  - 로그인 페이지 이동 → 사용자 로그인 대기
  - Finance 섹션 접근 가능 여부로 로그인 성공 자동 감지
  - 감지되면 즉시 다음 단계 자동 진행 (확인 불필요)
- **각 단계 완료 후**: 사용자 확인 없이 자동으로 다음 단계 진행
- **진행 상황 보고**: 실시간으로 보고하되, 절대 멈추지 않음
- **에러 처리**: 자동 재시도 (최대 3회), 치명적 에러만 중단

### 나쁜 예 ❌
```
✅ 크롤링 완료했습니다. 
다음 단계로 진행할까요? (사용자 입력 대기) ← 절대 안 됨!
```

### 좋은 예 ✅
```
✅ 크롤링 완료 (11개 기사)
[2/5] 카테고리 분류 시작... ← 자동으로 바로 진행
```

### 로그인 플로우
```
1. 브라우저 열고 로그인 페이지 이동
2. "로그인해주세요. 완료되면 자동으로 진행됩니다." 메시지
3. [사용자가 로그인]
4. 5초마다 Finance 섹션 접근 가능 여부 체크
5. 접근 가능 감지 → "✅ 로그인 완료" → 즉시 크롤링 시작
```

---

## 2. 시간 효율 (Time Efficiency)

### 목표
전체 워크플로우를 **10-15분 내** 완료

### 시간 배분
- 크롤링: 2-3분
- 카테고리 분류: 30초
- 기사 분석: 5-7분 (3-Tier 전략)
- 팩트 체크: 1-2분
- 문서화: 1-2분

### 적용
- 우선순위 기반 처리 (중요한 것부터)
- 병렬 처리 가능한 작업은 동시 실행
- 불필요한 재접속 최소화

---

## 3. 우선순위 기반 처리 (Priority-Based Processing)

### 3-Tier 분석 전략

#### Tier 1: 핵심 (⭐⭐⭐) - 전체 원문 분석
- **대상**: M&A 주요 거래 ($1B 이상), 시장 충격 뉴스
- **수량**: 2-3개
- **처리**: Playwright로 전체 원문 추출 + 상세 분석
- **소요 시간**: 기사당 2-3분

#### Tier 2: 중요 (⭐⭐) - 중간 수준 분석
- **대상**: 섹터별 주요 뉴스, 규제/정책 변화
- **수량**: 3-4개
- **처리**: Preview 기반 + 선택적 원문 확인
- **소요 시간**: 기사당 1분

#### Tier 3: 참고 (⭐) - 요약만
- **대상**: 나머지 일반 뉴스
- **수량**: 나머지 전부
- **처리**: Preview 텍스트만 활용
- **소요 시간**: 기사당 10초

### 우선순위 자동 판단 기준
```
⭐⭐⭐ (Tier 1):
- M&A 거래액 ≥ $1B
- "market crash", "emergency meeting" 같은 충격 키워드
- Fed 금리 결정, 주요 경제 지표 발표

⭐⭐ (Tier 2):
- M&A 거래액 $100M - $1B
- 주요 기업 실적 발표 (Magnificent 7 등)
- 섹터별 규제 변화

⭐ (Tier 3):
- 일반 뉴스, 전문가 칼럼
- 특정 산업 동향
```

---

## 4. 에러 복구 (Error Recovery)

### 자동 재시도
- **네트워크 오류**: 5초 대기 후 재시도 (최대 3회)
- **페이지 로드 실패**: 3회 재시도
- **로그인 세션 만료**: 자동 재로그인 1회 시도

### 부분 실패 허용
- 일부 기사 실패 → 나머지 계속 처리
- 실패한 기사는 `failed_articles.json`에 기록
- 최종 문서에 "분석 불가" 표시

### 치명적 에러
다음 경우에만 워크플로우 중단:
- 로그인 3회 연속 실패
- 전체 기사의 50% 이상 실패
- Playwright 크래시

---

## 5. 명확한 진행 상황 (Clear Progress Tracking)

### 실시간 피드백 형식
```
🚀 WSJ 뉴스 분석 시작 (예상 소요: 10-12분)

[1/5] 크롤링 중...
  ├─ 로그인 완료 ✅
  ├─ 기사 목록 수집 중... 11개 발견
  └─ ✅ 크롤링 완료 (소요: 2분 15초)

[2/5] 카테고리 분류 중...
  ├─ ⭐⭐⭐ Tier 1: 2개 (M&A)
  ├─ ⭐⭐ Tier 2: 4개 (금융, 빅테크)
  └─ ⭐ Tier 3: 5개 (일반)
  └─ ✅ 분류 완료 (소요: 25초)

[3/5] 기사 분석 중...
  ├─ Tier 1 상세 분석 (2/2 완료)
  ├─ Tier 2 중간 분석 (4/4 완료)
  ├─ Tier 3 요약 생성 (5/5 완료)
  └─ ✅ 분석 완료 (소요: 6분 30초)

[4/5] 팩트 체크 중...
  ├─ 원문 검증: 9개 사실
  └─ ✅ 검증 완료 (소요: 1분 10초)

[5/5] 문서 생성 중...
  └─ ✅ 완료! WSJ_Finance_Daily_Analysis_251104.md

✨ 전체 완료 (총 소요: 11분 20초)
```

### workflow_status.json
진행 상황을 파일로 저장하여 중단/재시작 지원:
```json
{
  "date": "20251104",
  "status": "in_progress",
  "current_step": 3,
  "total_steps": 5,
  "steps": [
    {
      "name": "crawling",
      "status": "completed",
      "start_time": "2025-11-04T08:00:00Z",
      "end_time": "2025-11-04T08:02:15Z",
      "articles_found": 11
    },
    {
      "name": "categorizing",
      "status": "completed",
      "tier1": 2,
      "tier2": 4,
      "tier3": 5
    },
    {
      "name": "analyzing",
      "status": "in_progress",
      "completed": 8,
      "total": 11
    }
  ]
}
```

---

## 6. 검증 가능성 (Verifiability)

### 원칙
모든 중요 사실은 원문 인용과 함께 제시

### 적용
- **Tier 1 기사**: 모든 수치에 원문 인용
- **Tier 2 기사**: 핵심 사실만 원문 확인
- **Tier 3 기사**: Preview 기반 (원문 확인 생략)

### 검증 수준 표시
- ✅ **원문 확인**: 저장된 원문 파일에서 직접 확인
- ⚠️ **Preview 확인**: WSJ Preview 텍스트에서 확인
- ℹ️ **분석만**: AI 분석 결과 (원문 미확인)

---

## 7. 일관성 유지 (Consistency)

### 공통 데이터 구조
모든 JSON 파일에 다음 필드 포함:
```json
{
  "date": "YYYYMMDD",
  "timestamp": "ISO 8601 format",
  "version": "1.0",
  "articles": [
    {
      "id": "unique_id",
      "priority": "⭐⭐⭐|⭐⭐|⭐",
      "processing_time": 120
    }
  ]
}
```

### 파일 네이밍
- 원문 파일: `data/YYYYMMDD/articles/{article_id}_original.txt`
- JSON 파일: `data/YYYYMMDD/{stage}.json`
- 최종 문서: `WSJ_Finance_Daily_Analysis_YYYYMMDD.md`

---

## 사용자 경험 목표

### 이상적인 실행 시나리오
```
사용자: "WSJ 뉴스 분석해줘"

AI: 🚀 WSJ 뉴스 분석을 시작합니다.
    브라우저를 엽니다. 로그인해주세요.
    
사용자: [브라우저에서 수동 로그인]

AI: ✅ 로그인 완료 감지!
    [10-15분 동안 자동 실행, 실시간 진행 상황만 보고]
    [절대 중간에 멈추지 않고 끝까지 실행]

AI: ✨ 분석 완료!
    📄 WSJ_Finance_Daily_Analysis_251104.md
    
    📊 요약:
    - 총 11개 기사 분석
    - ⭐⭐⭐ 주요 거래 2건 (Kimberly-Clark $48.7B, Denny's $322M)
    - ✅ 9개 핵심 사실 검증 완료
    - ⏱️ 소요 시간: 11분 20초
```

### 주인님 만족도 기준
- ✅ 중간에 멈추지 않고 끝까지 실행
- ✅ 10-15분 내 완료
- ✅ 중요한 뉴스는 상세히, 나머지는 간략히
- ✅ 모든 수치는 원문 인용으로 검증
- ✅ 명확한 진행 상황 표시

