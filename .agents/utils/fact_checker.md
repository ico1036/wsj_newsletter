# 팩트 체크 에이전트

## 목적
분석된 기사 내용의 핵심 사실을 검증하여 Hallucination을 방지합니다.

## 실행 방법

```
@utils/fact_checker [날짜]
```

날짜가 지정되지 않으면 오늘 날짜 사용. `data/YYYYMMDD/analyzed_content.json` 파일을 읽어서 처리합니다.

## 입력

- **파일**: `data/YYYYMMDD/analyzed_content.json` (기사 분석 결과)

## 검증 항목

다음 항목들을 검증합니다:

### 1. 수치 검증
- **거래 가액**: 금액, 통화 단위 확인
- **주가**: 가격, 변동률 확인
- **비율**: 프리미엄, 지분 비율 등
- **날짜**: 거래일, 예상 마감일 등

### 2. 기업명 검증
- **정확한 회사명**: 스펠링 확인
- **상장 심볼**: 티커 심볼 확인
- **기업 관계**: 모회사, 자회사 관계 확인

### 3. 인물 검증
- **이름 정확성**: CEO, 임원 이름 스펠링
- **직책**: 정확한 직책명 확인

### 4. 날짜 검증
- **일관성**: 분석 날짜와 뉴스 발행일 일치 확인
- **타임라인**: 거래 일정의 논리적 일관성

### 5. 인용문 검증
- **원문 확인**: 기사에서 직접 인용문 추출
- **출처 확인**: 누가 언급했는지 명확히

## 처리 과정

1. **입력 파일 읽기**
   - `data/YYYYMMDD/analyzed_content.json` 파일 로드
   - 각 기사의 `key_facts_to_verify` 리스트 확인

2. **원문 텍스트 확인**
   - 각 기사의 `original_text_path` 확인
   - 원문 텍스트 파일이 있으면 파일에서 읽기 (재접속 불필요)
   - 원문 텍스트 파일이 없으면 Playwright로 원본 기사 접속 (세션 재사용)

3. **핵심 사실 검증**
   - 각 `key_facts_to_verify`의 사실을 원문에서 재확인
   - 수치 데이터: 정확한 값 확인
   - 기업명/인물명: 스펠링 확인
   - 날짜: 일관성 확인
   - 인용문: 원문과 일치 여부 확인

4. **검증 결과 기록**
   - 각 사실에 대해 검증 상태 표시:
     - ✅ 원문 재확인 완료 (원문 파일 사용)
     - ✅ 원문 재확인 완료 (웹페이지 재접속)
     - ⚠️ 원문과 다름 (원문 우선, 수정된 값 저장)
     - ⚠️ 분석 결과만 확인 (원문 파일 없음, 신뢰도 낮음)
     - ❌ 확인 불가 (원문에서 찾을 수 없음)

5. **데이터 저장**
   - `data/YYYYMMDD/verified.json` 파일에 저장
   - 형식:
     ```json
     {
       "date": "20251104",
       "verification_time": "2025-11-04T08:45:00Z",
       "verification_summary": {
         "total_facts": 150,
         "verified_from_file": 120,
         "verified_from_web": 25,
         "mismatches": 3,
         "unverifiable": 2
       },
       "articles": [
         {
           "article_id": "article_001",
           "title": "Article Title",
           "url": "https://www.wsj.com/...",
           "verified_facts": [
             {
               "fact_id": "fact_001",
               "fact_text": "거래 가액: 48억 달러",
               "extracted_value": "48 billion",
               "verified_value": "48.7 billion",
               "status": "⚠️ mismatch",
               "verification_method": "file",
               "original_text": "The deal is valued at $48.7 billion including debt",
               "notes": "부채 포함 48.7B로 확인됨"
             }
           ]
         }
       ]
     }
     ```

6. **진행 상황 출력**
   - "팩트 체크 진행 중... (X/150 완료)"
   - "원문 파일 활용: X개, 웹 재접속: Y개"

## 출력

- **파일**: `data/YYYYMMDD/verified.json`
- **콘솔**: 검증 결과 요약 출력

## 검증 우선순위

1. **최우선**: 수치 데이터 (금액, 비율, 날짜)
2. **중요**: 기업명, 인물명
3. **보조**: 인용문, 맥락 설명

## Hallucination 방지 전략

1. **원문 재확인**: 모든 핵심 사실은 원문에서 다시 확인
2. **불확실한 정보 제외**: 확인할 수 없는 정보는 문서에 포함하지 않음
3. **추측 금지**: 기사에 명시되지 않은 내용은 추론하지 않음
4. **검증 섹션 포함**: 최종 문서에 검증 완료 사항 명시

## 검증 완료 표시 형식

최종 문서에 다음과 같은 섹션 추가:

```markdown
## 🔍 검증 팩트 체크

### 검증 완료 사항 ✅

1. **Kimberly-Clark-Kenvue 거래**
   - 주당 가격 $21.01 ✅ (기사 원문 확인)
   - 총 거래액 $48.7B (부채 포함) ✅
   - 예상 마감 2026 하반기 ✅
```

## 주의사항

- **원문 우선**: 원문과 분석 내용이 다를 경우 항상 원문 우선
- **확인 불가 처리**: 확인 불가한 정보는 "확인 불가"로 표시하고 최종 문서에서 제외
- **검증 수준 표시**: 각 검증 결과에 검증 방법 표시 (원문 파일/웹 재접속)
- **효율성**: 원문 텍스트 파일이 있으면 재접속하지 않고 파일에서 검증
- **부분 검증**: 일부 사실만 검증 불가해도 나머지는 계속 검증

